import{_ as c,c as u,ah as a,b as i,w as n,ai as r,j as t,B as m,o,G as l,a as p}from"./chunks/framework.BWXOFiC5.js";const I=JSON.parse('{"title":"Troubleshooting Guide","description":"","frontmatter":{},"headers":[],"relativePath":"Documentation/Troubleshooting/troubleshooting.md","filePath":"Documentation/Troubleshooting/troubleshooting.md"}'),d={name:"Documentation/Troubleshooting/troubleshooting.md"};function h(g,e,b,f,y,w){const s=m("Mermaid");return o(),u("div",null,[e[2]||(e[2]=a('<h1 id="troubleshooting-guide" tabindex="-1">Troubleshooting Guide <a class="header-anchor" href="#troubleshooting-guide" aria-label="Permalink to &quot;Troubleshooting Guide&quot;">​</a></h1><div class="warning custom-block github-alert"><p class="custom-block-title">*ImmyBot&#39;s EV code-signing certificate is changing on Feb. 11th, 2025*</p><p>Please see the <a href="https://docs.immy.bot/FAQ.html#what-should-i-do-about-immybot-s-upcoming-code-signing-certificate-change" target="_blank" rel="noreferrer">FAQ section for more details</a> on updating security exclusions.</p></div><div class="danger custom-block"><p class="custom-block-title"><em>ImmyBot no longer supports Windows 7, Server 2008 (or Server 2012 w/o <a href="https://learn.microsoft.com/en-us/windows-server/get-started/extended-security-updates-overview" target="_blank" rel="noreferrer">ESUs</a>) machines.</em></p><p>Please see the <a href="https://docs.immy.bot/FAQ.html#what-windows-versions-does-immyagent-support" target="_blank" rel="noreferrer">FAQ section for more details</a></p></div><p>This comprehensive guide will help you troubleshoot common issues with ImmyBot, including agent connectivity problems, identification failures, security software conflicts, and more. Follow the step-by-step instructions to diagnose and resolve issues quickly.</p><h2 id="identification-failures" tabindex="-1">Identification Failures <a class="header-anchor" href="#identification-failures" aria-label="Permalink to &quot;Identification Failures&quot;">​</a></h2><h3 id="needs-a-manual-decision" tabindex="-1">Needs a Manual Decision <a class="header-anchor" href="#needs-a-manual-decision" aria-label="Permalink to &quot;Needs a Manual Decision&quot;">​</a></h3><p>Generally you will click &quot;Agent Re-installed&quot;</p><p>Often when an RMM Agent gets re-installed, it will get a new id in the RMM (ComputerId in Automate, SessionID in Control). ImmyBot will recognize that it is the same computer, but due to the fact that virtualization technologies and hard drive cloning can lead to the same scenario, we require you to tell us whether we should overwrite the existing RmmComputer, or keep both. 99% of the time you will click &quot;Overwrite Existing&quot;. If the machine was in fact cloned, you would click Keep Both, in which case Immy shims the duplicate UUID with its own to prevent collisions.</p><h2 id="pending-computers" tabindex="-1">Pending Computers <a class="header-anchor" href="#pending-computers" aria-label="Permalink to &quot;Pending Computers&quot;">​</a></h2><p>Computers in the pending status have yet to be identified.</p><p>Computers may get stuck here if we are unable to run our Ephemeral Agent</p>',11)),(o(),i(r,null,{default:n(()=>[l(s,{id:"mermaid-37",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20CheckImmyAgentLogs%5BCheck%20ImmyAgent%20Logs%20in%20C%3A%5CProgramData%5CImmyBot%5CLogs%5D%20--%3E%20DidEphemeralAgentStart%5BImmybot.Agent.Ephemeral.exe%20start%3F%5D%0A%20%20%20%20DidEphemeralAgentStart%20--%3E%20%7CYes%7CCheckEphemeralAgentLogs%5BCheck%20Ephemeral%20Agent%20logs%20in%20C%3A%5CProgramData%5CImmyBot%5CScripts%5C*%5C*.log%5D%0A%20%20%20%20DidEphemeralAgentStart%20--%3E%20%7CNo%7CBlockedBySecuritySoftware%5BExclude%20Script%20Path%20from%20Security%20Software%5D%0A%20%20%20%20CheckEphemeralAgentLogs%20--%3E%20EphemeralAgentConnect%5BDid%20Ephemeral%20Agent%20Websocket%20Connect%3F%5D%0A%20%20%20%20EphemeralAgentConnect%20--%3E%7CYes%7CDidSuccessfullyIdentifyAfterFix%0A%20%20%20%20EphemeralAgentConnect%20--%3E%20%7CNo%7CTryNoSSLInspect%5BPut%20on%20network%20without%20SSL%20Inspection%5D%0A%20%20%20%20TryNoSSLInspect%20--%3E%20DidSuccessfullyIdentifyAfterFix%5BEphemeral%20Agent%20Connect%20After%20Fix%3F%5D%0A%20%20%20%20DidSuccessfullyIdentifyAfterFix%5BMachine%20Identify%20Successfully%3F%5D%20--%3E%20%7CNo%7CEmailSupport%0A%20%20%20%20DidSuccessfullyIdentifyAfterFix%5BMachine%20Identify%20Successfully%3F%5D%20--%3E%20%7CYes%7CDone%0A%20%20%20%20EmailSupport%5B%22Email%20logs%20from%20C%3A%5CProgramData%5CImmyBot%5CLogs%20and%20C%3A%5CProgramData%5CImmyBot%5CScripts%5C*%5C*.logs%20to%20support%40immy.bot%22%5D%0A"})]),fallback:n(()=>e[0]||(e[0]=[p(" Loading... ")])),_:1})),e[3]||(e[3]=t("p",null,"Top 3 reasons for Identification Failures",-1)),e[4]||(e[4]=t("ol",null,[t("li",null,"SSL Inspection blocking our websocket"),t("li",null,"Security Software blocking PowerShell"),t("li",null,"Incorrect time is preventing SSL/TLS connection")],-1)),e[5]||(e[5]=t("p",null,"To understand the various reasons identification can fail, it helps to understand how ImmyBot executions PowerShell",-1)),e[6]||(e[6]=t("ol",null,[t("li",null,"RMM or ImmyAgent runs Immybot.Agent.Ephemeral.exe"),t("li",null,"Immybot.Agent.Ephemeral.exe establishes a secure websocket to wss://subdomain.immy.bot and runs Invoke-PSPipeHost.ps1"),t("li",null,"Immybot.Agent.Ephemeral.exe feeds Invoke-PSPipeHost.ps1 PowerShell over a pipe from the websocket session")],-1)),(o(),i(r,null,{default:n(()=>[l(s,{id:"mermaid-78",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20ImmyBot%20--%3E%20%7CParallel%7CAutomate%5BRun%20script%20to%20download%20and%20run%20Ephemeral%20Agent%20via%20Automate%5D%0A%20%20%20%20ImmyBot%20--%3E%20%7CParallel%7CControl%5BRun%20script%20to%20download%20and%20run%20Ephemeral%20Agent%20via%20Control%5D%0A%20%20%20%20ImmyBot%20--%3E%20%7CParallel%7CImmyAgent%5BRun%20script%20to%20download%20and%20run%20Ephemeral%20Agent%20via%20ImmyAgent%5D%0A%20%20%20%20ImmyBot%20--%3E%20%7CParallel%7CN-Central%5BRun%20script%20to%20download%20and%20run%20Ephemeral%20Agent%20via%20N-Central%5D%0A%20%20%20%20Automate%20--%3E%20Immybot.Agent.Ephemeral.exe%0A%20%20%20%20Control%20--%3E%20Immybot.Agent.Ephemeral.exe%0A%20%20%20%20ImmyAgent%20--%3E%20Immybot.Agent.Ephemeral.exe%0A%20%20%20%20N-Central%20--%3E%20Immybot.Agent.Ephemeral.exe%0A%20%20%20%20Immybot.Agent.Ephemeral.exe%20--%3E%20cmd.exe%20--%3E%20powershell.exe%20--%3E%20Invoke-PSPipeHost.ps1%0A"})]),fallback:n(()=>e[1]||(e[1]=[p(" Loading... ")])),_:1})),e[7]||(e[7]=a(`<p>The most common cause of identification failure is security software.</p><p>To know if this is the case, pull the logs from C:\\ProgramData\\ImmyBot\\Logs and C:\\ProgramData\\ImmyBot\\Scripts**.logs</p><p>Normal Immybot Agent logs look like this:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>2022-06-14 00:02:25.560 -05:00 [DBG] Hosting starting</span></span>
<span class="line"><span>2022-06-14 00:02:25.799 -05:00 [INF] Starting Immybot Agent</span></span>
<span class="line"><span>2022-06-14 00:02:25.943 -05:00 [INF] Using configuration file stored at: C:\\ProgramData\\ImmyBotAgentService\\config.json</span></span>
<span class="line"><span>2022-06-14 00:02:26.875 -05:00 [DBG] Initializing IoT Hub connection</span></span>
<span class="line"><span>2022-06-14 00:02:35.023 -05:00 [INF] Application started. Hosting environment: Production; Content root path: C:\\WINDOWS\\TEMP\\.net\\Immybot.Agent.Service\\lreaszzz.wwx\\</span></span>
<span class="line"><span>2022-06-14 00:02:35.024 -05:00 [DBG] Hosting started</span></span>
<span class="line"><span>2022-06-14 00:02:40.552 -05:00 [WRN] IoT Hub connection status Changed Status =&gt; [Connected] Reason =&gt; [Connection_Ok]</span></span>
<span class="line"><span>2022-06-14 02:06:32.159 -05:00 [DBG] Process started; ID: 12724</span></span>
<span class="line"><span>2022-06-14 02:06:37.358 -05:00 [DBG] Running C:\\ProgramData\\ImmyBot\\Scripts\\840290f2bd2142e2bd2c612542436763\\Immybot.Agent.Ephemeral.exe --ImmyScriptPath C:\\ProgramData\\ImmyBot\\Scripts\\840290f2bd2142e2bd2c612542436763 --BackendAddress wss://immense.immy.bot/ --SessionID c946e1d1-f5fd-d36d-0489-d2a9ad9084e0</span></span>
<span class="line"><span>2022-06-14 02:06:38.335 -05:00 [DBG] PID 16184 &lt;----- Indicates successful execution</span></span>
<span class="line"><span>2022-06-14 02:06:38.372 -05:00 [DBG] Process exited; Code: 0</span></span></code></pre></div><p>Windows Defender will make the logs look like this:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>2022-11-17 13:13:36.604 +11:00 [DBG] Hosting starting</span></span>
<span class="line"><span>2022-11-17 13:13:36.817 +11:00 [INF] Starting Immybot Agent</span></span>
<span class="line"><span>2022-11-17 13:13:36.840 +11:00 [INF] Using configuration file stored at: C:\\ProgramData\\ImmyBotAgentService\\config.json</span></span>
<span class="line"><span>2022-11-17 13:13:37.590 +11:00 [DBG] Initializing IoT Hub connection</span></span>
<span class="line"><span>2022-11-17 13:13:37.860 +11:00 [DBG] Hosting started</span></span>
<span class="line"><span>2022-11-17 13:13:38.598 +11:00 [WRN] IoT Hub connection status Changed Status =&gt; [Connected] Reason =&gt; [Connection_Ok]</span></span>
<span class="line"><span>2022-11-17 13:13:39.157 +11:00 [WRN] Dirty-Shutdown detected! Dirty-File created at: &quot;2022-11-07T04:11:59.3975026Z&quot; UTC</span></span>
<span class="line"><span>2022-11-17 13:13:41.686 +11:00 [DBG] Process started; ID: 5660</span></span>
<span class="line"><span>2022-11-17 13:13:44.674 +11:00 [DBG] Running C:\\ProgramData\\ImmyBot\\Scripts\\4303da9b790b41c6978b50b872fe17cb\\Immybot.Agent.Ephemeral.exe --ImmyScriptPath C:\\ProgramData\\ImmyBot\\Scripts\\4303da9b790b41c6978b50b872fe17cb --BackendAddress wss://ericom.immy.bot/ --SessionID a92c0ed1-ea3b-7f8a-d9c6-946d9b44ccc5</span></span>
<span class="line"><span>2022-11-17 13:13:49.577 +11:00 [DBG] WMI Error 2</span></span></code></pre></div><p>DNS Filtering/Issues make the logs look like this</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>2022-09-20 20:39:59.712 +10:00 [INF] RESPONSE: {</span></span>
<span class="line"><span>  &quot;Resource&quot;: &quot;installer/challenge/request&quot;,</span></span>
<span class="line"><span>  &quot;Method&quot;: &quot;POST&quot;,</span></span>
<span class="line"><span>  &quot;StatusCode&quot;: 0,</span></span>
<span class="line"><span>  &quot;ErrorException&quot;: {</span></span>
<span class="line"><span>    &quot;ClassName&quot;: &quot;System.Net.WebException&quot;,</span></span>
<span class="line"><span>    &quot;Message&quot;: &quot;No such host is known. (XXXX.immy.bot:443)&quot;</span></span></code></pre></div><p>To correct it, you need to exclude DNS filtering for your instances hostnames, which are found under Show more &gt; integrations &gt; Fetch IP Address and Hostnames</p><p>If Powershell is failing to start on the endpoint within 60 seconds a timeout will occur.</p><p>Here is a suggestion on a cause and possible fix for that one <a href="https://www.reddit.com/r/PowerShell/comments/rx68fw/powershell_slow_to_open_long_load_timesfixed" target="_blank" rel="noreferrer">https://www.reddit.com/r/PowerShell/comments/rx68fw/powershell_slow_to_open_long_load_timesfixed</a></p><h2 id="group-policy-objects" tabindex="-1">Group Policy Objects <a class="header-anchor" href="#group-policy-objects" aria-label="Permalink to &quot;Group Policy Objects&quot;">​</a></h2><p>PowerShell execution policies set through Group Policy can affect ImmyBot&#39;s ability to run scripts. Ensure the following GPO settings are configured correctly:</p><p><strong>Required GPO Settings:</strong></p><ul><li>Computer Configuration | Policies | Administrative Templates | Windows Components | Windows PowerShell | Turn on Script Execution (Enabled)</li><li>User Configuration | Policies | Administrative Templates | Windows Components | Windows PowerShell | Turn on Script Execution (Enabled)</li></ul><p>These GPOs have been known to cause issues with running scripts if not properly configured. We recommend setting the execution policy to &quot;RemoteSigned&quot; or &quot;Unrestricted&quot; for ImmyBot to function properly.</p><h2 id="working-with-support" tabindex="-1">Working With Support <a class="header-anchor" href="#working-with-support" aria-label="Permalink to &quot;Working With Support&quot;">​</a></h2><p>When you&#39;ve tried all the troubleshooting steps and still need assistance, our support team is ready to help.</p><p><strong>Support Contact Information:</strong></p><ul><li>Email: <code>support@immy.bot</code></li></ul><h2 id="preparing-for-support" tabindex="-1">Preparing for Support <a class="header-anchor" href="#preparing-for-support" aria-label="Permalink to &quot;Preparing for Support&quot;">​</a></h2><p>To help our support team resolve your issue quickly, please provide the following information:</p><ol><li><p><strong>Detailed Description:</strong></p><ul><li>What you were trying to do</li><li>What happened instead</li><li>Any error messages you received</li><li>When the issue started occurring</li></ul></li><li><p><strong>Environment Information:</strong></p><ul><li>ImmyBot version</li><li>Agent version</li><li>Operating system version</li><li>Security software in use</li></ul></li><li><p><strong>Logs and Diagnostics:</strong></p><ul><li>Agent logs from C:\\ProgramData\\ImmyBot\\Logs</li><li>Script logs from C:\\ProgramData\\ImmyBot\\Scripts**.logs</li><li>Any additional diagnostic information as described below</li><li>A session link or number (if applicable)</li></ul></li></ol><h2 id="gather-an-endpoint-trace-log" tabindex="-1">Gather an Endpoint Trace Log <a class="header-anchor" href="#gather-an-endpoint-trace-log" aria-label="Permalink to &quot;Gather an Endpoint Trace Log&quot;">​</a></h2><p>Windows Performance Recorder can generate a detailed log of an endpoint&#39;s activity, which can be used to identify environmental causes for issues running the ImmyBot Agent.</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>These traces can be resource intensive and may require 2-4 GB available RAM, depending on how active an endpoint is and how long a trace is running.</p></div><p><strong>Steps to Collect a Trace:</strong></p><ol><li>From an elevated CMD prompt, run:</li></ol><div class="language-bat vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wpr.exe -start CPU -start Minifilter -start FileIO -start Registry</span></span></code></pre></div><ol start="2"><li>Recreate the issue that you&#39;re experiencing.</li><li>Wait 3-5 minutes, depending on the available RAM, and run:</li></ol><div class="language-bat vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wpr.exe -stop </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;C:\\PerfLogs\\examplefilename.etl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -compress</span></span></code></pre></div><p>If the <code>wpr -stop</code> command fails, try running without the &quot;-compress&quot; parameter.</p><p>This ETL file can be reviewed in Windows Performance Analyzer from the Windows Performance Toolkit SDK.</p><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">​</a></h2><p>After resolving your issue, consider reviewing these related resources:</p><ul><li><a href="/Documentation/Troubleshooting/common-issues.html">Common Issues</a> - Solutions to frequently encountered problems</li><li><a href="/Documentation/Troubleshooting/security-software.html">Security Software Configuration</a> - Configure security software to work with ImmyBot</li><li><a href="/Documentation/FAQ.html">FAQ</a> - Answers to common questions about ImmyBot</li></ul>`,36))])}const A=c(d,[["render",h]]);export{I as __pageData,A as default};
